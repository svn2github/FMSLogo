LOAD "testlib.lgo

TO LABELCIRCLETEST

  CLEARSCREEN
  CLEARPALETTE
  SETSCREENCOLOR 7

  HIDETURTLE
  PENUP
  REPEAT 360 / 15 [
    FORWARD 175 
    SETPENCOLOR (LIST 0 REPCOUNT*8 0) 
    SETTEXTFONT (LIST [Arial] 10 + REPCOUNT * 2 0 0 400 0 0 0)
    LABEL (LIST REPCOUNT)
    BACK 175
    RIGHT 15
  ]
  PENDOWN
  SHOWTURTLE

  CHECKSCREEN "font-circle

END

TO LABELTEST.PRINTLIMITS
  LOCAL [text printdepthlimit printwidthlimit originalsize]

  SETLABELFONT [System]
  make "text [ABCDEFGHIJKLMNOPQRSTUVWXYZ [12 34 56 78 90] {AB CD EF GH IJ KL MN OP QR ST UV WX YZ}]

  ; Determine the size of the text when there are no limits
  TRACEINSTRUCTION [ make "originalsize LABELSIZE :text ]

  ; Set the print limits
  TRACEINSTRUCTION [ make "printdepthlimit 2 ]
  TRACEINSTRUCTION [ make "printwidthlimit 3 ]

  ; Confirm that the size is not as wide, but is as high
  FAILIFNOTTRUE [ LESSP  ITEM 1 LABELSIZE :text ITEM 1 :originalSize ]
  FAILIFNOTTRUE [ EQUALP ITEM 2 LABELSIZE :text ITEM 2 :originalSize ]

  ; Call LABEL on the text
  SETSCREENCOLOR "White
  SETPENCOLOR    "Black
  CLEARSCREEN
  CLEARPALETTE
  HIDETURTLE
  RIGHT 90
  LABEL :text

  CHECKSCREEN "label-with-print-limits
  SHOWTURTLE
END


TO LABELBADINPUTTEST
  RUNNOTENOUGHINPUTSTEST [(LABEL)]
  RUNTOOMANYINPUTSTEST   [(LABEL 1 1)]
END

TO SETLABELFONTTEST

  CLEARPALETTE
  CLEARSCREEN
  SETPENCOLOR    2
  SETSCREENCOLOR 7

  ; Setting the label font to an unknown font is defined to 
  ; enumerate all known fonts.
  SETLABELFONT [unknown]

  SETLABELFONT [System]
  CLEARSCREEN
  CLEARPALETTE
  SETSCREENCOLOR 4
  SETPENCOLOR    3
  RIGHT 90
  LABEL [This is the system font]

  ; verify the font is correct
  CHECKSCREEN "system-font


  SETLABELFONT [[Arial] 24 0 0 400 0 0 0 0 0 0 0 0]
  CLEARSCREEN
  CLEARPALETTE
  SETSCREENCOLOR 3
  SETPENCOLOR    4
  RIGHT 90
  LABEL [This is Arial]
  CHECKSCREEN "arial-font


  ; verify that the LABELFONT was set as expected
  FAILIFNOTTRUE    [ LIST? LABELFONT ]
  SIMPLEREPORTTEST [ COUNT LABELFONT ] 13
  SIMPLEREPORTTEST [ITEM  1 LABELFONT] [Arial]
  SIMPLEREPORTTEST [ITEM  2 LABELFONT] 24
  SIMPLEREPORTTEST [ITEM  3 LABELFONT] 0
  SIMPLEREPORTTEST [ITEM  4 LABELFONT] 0
  SIMPLEREPORTTEST [ITEM  5 LABELFONT] 400
  SIMPLEREPORTTEST [ITEM  6 LABELFONT] 0
  SIMPLEREPORTTEST [ITEM  7 LABELFONT] 0
  SIMPLEREPORTTEST [ITEM  8 LABELFONT] 0
  SIMPLEREPORTTEST [ITEM  9 LABELFONT] 0
  SIMPLEREPORTTEST [ITEM 10 LABELFONT] 0
  SIMPLEREPORTTEST [ITEM 11 LABELFONT] 0
  SIMPLEREPORTTEST [ITEM 12 LABELFONT] 0
  SIMPLEREPORTTEST [ITEM 13 LABELFONT] 0


  ; these result in a font-not-found behavior
  SETLABELFONT [0]
  SETLABELFONT []   ; bug #1438909 
  SETLABELFONT [[]]
  SETLABELFONT [[unknownfont]]

  ; bad input tests
  RUNBADINPUTTEST [SETLABELFONT "Courier]
  RUNBADINPUTTEST [SETLABELFONT 1.1]
  RUNBADINPUTTEST [SETLABELFONT {0}]
  RUNBADINPUTTEST [SETLABELFONT [[Arial] bad   0   0 400   0   0   0   0   0   0   0   0]]
  RUNBADINPUTTEST [SETLABELFONT [[Arial]  24 bad   0 400   0   0   0   0   0   0   0   0]]
  RUNBADINPUTTEST [SETLABELFONT [[Arial]  24   0 bad 400   0   0   0   0   0   0   0   0]]
  RUNBADINPUTTEST [SETLABELFONT [[Arial]  24   0   0 bad   0   0   0   0   0   0   0   0]]
  RUNBADINPUTTEST [SETLABELFONT [[Arial]  24   0   0 400 bad   0   0   0   0   0   0   0]]
  RUNBADINPUTTEST [SETLABELFONT [[Arial]  24   0   0 400   0 bad   0   0   0   0   0   0]]
  RUNBADINPUTTEST [SETLABELFONT [[Arial]  24   0   0 400   0   0 bad   0   0   0   0   0]]
  RUNBADINPUTTEST [SETLABELFONT [[Arial]  24   0   0 400   0   0   0 bad   0   0   0   0]]
  RUNBADINPUTTEST [SETLABELFONT [[Arial]  24   0   0 400   0   0   0   0 bad   0   0   0]]
  RUNBADINPUTTEST [SETLABELFONT [[Arial]  24   0   0 400   0   0   0   0   0 bad   0   0]]
  RUNBADINPUTTEST [SETLABELFONT [[Arial]  24   0   0 400   0   0   0   0   0   0 bad   0]]
  RUNBADINPUTTEST [SETLABELFONT [[Arial]  24   0   0 400   0   0   0   0   0   0   0 bad]]

  RUNNOTENOUGHINPUTSTEST [(SETLABELFONT)]
  RUNTOOMANYINPUTSTEST   [(SETLABELFONT [[Arial]] "toomany)]


  REPORTTESTINFO [Testing that SETLABELFONT doesn't modify its input list on error]
  localmake "original [SETLABELFONT [[Arial] 24 0 0 400 0 0 bad 0 0 0 0 0]]
  localmake "used     [SETLABELFONT [[Arial] 24 0 0 400 0 0 bad 0 0 0 0 0]]
  CATCH "ERROR :used
  IGNORE ERROR
  REPORTTESTINFO [Now comparing the original instruction to the one that was used]
  FAILIFNOTTRUE (LIST :original "= :used)

END

TO LABELTEST
  LABELCIRCLETEST
  LABELBADINPUTTEST

  SETLABELFONTTEST
  LABELTEST.PRINTLIMITS
END

