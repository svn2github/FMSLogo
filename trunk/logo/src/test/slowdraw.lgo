LOAD "testlib.lgo

TO SLOWDRAWTEST.TIMECOMMAND :instructions :mintime :maxtime

   ; A helper for running and timing a command and testing
   ; that it is within the expected range.

   LOCALMAKE "executiontime TIMECOMMAND :instructions
   CHECKEXECUTIONTIME :instructions :executiontime :mintime :maxtime
END

TO SLOWDRAWTEST.SMOKETEST
   HIDETURTLE ; for more consistent drawing times

   ; slowdraw at 100
   TRACEINSTRUCTION [ SLOWDRAW 100 ]
   SLOWDRAWTEST.TIMECOMMAND [FD      100] 100*(1000/60) 100*(1000/60)*2
   SLOWDRAWTEST.TIMECOMMAND [FORWARD 100] 100*(1000/60) 100*(1000/60)*2
   SLOWDRAWTEST.TIMECOMMAND [BK      100] 100*(1000/60) 100*(1000/60)*2
   SLOWDRAWTEST.TIMECOMMAND [BACK    100] 100*(1000/60) 100*(1000/60)*2

   ; slowdraw at 200
   TRACEINSTRUCTION [ SLOWDRAW 200 ]
   SLOWDRAWTEST.TIMECOMMAND [FD      100] 200*(1000/60) 200*(1000/60)*2
   SLOWDRAWTEST.TIMECOMMAND [FORWARD 100] 200*(1000/60) 200*(1000/60)*2
   SLOWDRAWTEST.TIMECOMMAND [BK      100] 200*(1000/60) 200*(1000/60)*2
   SLOWDRAWTEST.TIMECOMMAND [BACK    100] 200*(1000/60) 200*(1000/60)*2

   ; back to normal
   TRACEINSTRUCTION [ SLOWDRAW 0 ]
   SLOWDRAWTEST.TIMECOMMAND [FD      100] 0 20
   SLOWDRAWTEST.TIMECOMMAND [FORWARD 100] 0 20
   SLOWDRAWTEST.TIMECOMMAND [BK      100] 0 20
   SLOWDRAWTEST.TIMECOMMAND [BACK    100] 0 20

   SHOWTURTLE

END


TO SLOWDRAWTEST.BADINPUT

   ; clear any slowdraw that may already exist
   TRACEINSTRUCTION [ SLOWDRAW 0 ]

   RUNNOTENOUGHINPUTSTEST [(SLOWDRAW)]
   RUNTOOMANYINPUTSTEST   [(SLOWDRAW 10 "toomany)]

   RUNBADINPUTTEST [SLOWDRAW -100]
   RUNBADINPUTTEST [SLOWDRAW 100.5]
   RUNBADINPUTTEST [SLOWDRAW [100]]
   RUNBADINPUTTEST [SLOWDRAW {100}]

   ; make sure that FD and BK still work
   REPEAT 4 [ FORWARD 100 RIGHT 90 ]
   REPEAT 4 [ FD      100 LEFT  90 ]
   REPEAT 4 [ BACK    100 RIGHT 90 ]
   REPEAT 4 [ BK      100 LEFT  90 ]

END

TO SLOWDRAWTEST

   SLOWDRAWTEST.SMOKETEST
   SLOWDRAWTEST.BADINPUT

END
