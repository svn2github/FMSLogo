LOAD "testlib.lgo

TO MYADD :a :b
  OUTPUT SUM :a :b
END

TO COPYDEFSTOPTEST
   COPYDEF "MYSTOP "STOP
   MYSTOP
   REPORTTESTFAILED [A COPYDEF of STOP did not behave like STOP]
END

TO COPYDEFOUTPUTTEST
   COPYDEF "MYOUTPUT "OUTPUT
   MYOUTPUT 373
   REPORTTESTFAILED [A COPYDEF of OUTPUT did not behave like OUTPUT]
END

TO COPYDEFMAYBEOUTPUTTEST
   COPYDEF "MYMAYBEOUTPUT ".MAYBEOUTPUT
   MYMAYBEOUTPUT 373
   REPORTTESTFAILED [A COPYDEF of .MAYBEOUTPUT did not behave like .MAYBEOUTPUT]
END

TO COPYDEFOPTEST
   COPYDEF "MYOP "OP
   MYOP 373
   REPORTTESTFAILED [A COPYDEF of OP did not behave like OP]
END

COPYDEF "TOCOPY "TO
TOCOPY COPYDEFTOTEST
  OUTPUT 373
END

TO COPYDEFTEST

   ;
   ; copydef a primitive
   ;
   COPYDEF "SUMCOPY "SUM
   
   ; does the copy behave line the original
   SIMPLEREPORTTEST [SUMCOPY 1 2    ] 3
   SIMPLEREPORTTEST [(SUMCOPY 1 2 3)] 6
   SIMPLEREPORTTEST [(SUMCOPY)      ] 0

   RUNBADINPUTTEST [SUMCOPY 1    "ten]
   RUNBADINPUTTEST [SUMCOPY "ten 1]

   ;
   ; copydef an infix procedure
   ;
   COPYDEF "MYPLUS "+

   SIMPLEREPORTTEST [1 MYPLUS 2         ] 3
   SIMPLEREPORTTEST [1 MYPLUS 2 MYPLUS 3] 6

   RUNBADINPUTTEST [1    MYPLUS "ten]
   RUNBADINPUTTEST ["ten MYPLUS 1   ]
   RUNNOTENOUGHINPUTSTEST [(MYPLUS)]

   ;
   ; copydef a user-defined procedure
   ;
   COPYDEF "MYADDCOPY "MYADD
   
   ; does the copy behave line the original
   SIMPLEREPORTTEST [MYADDCOPY 1 2] 3


   ; copydef procedures with special forms
   COPYDEFSTOPTEST ; bug #1448142 
   ;SIMPLEREPORTTEST [COPYDEFOUTPUTTEST      ] 373 ; bug #1454113 
   ;SIMPLEREPORTTEST [COPYDEFOPTEST          ] 373 ; bug #1454113
   ;SIMPLEREPORTTEST [COPYDEFMAYBEOUTPUTTEST ] 373 ; bug #1454113 
   SIMPLEREPORTTEST [COPYDEFTOTEST          ] 373

   ; bad inputs
   RUNNOTENOUGHINPUTSTEST [(COPYDEF)]
   RUNNOTENOUGHINPUTSTEST [(COPYDEF "MYLIST)]
   RUNTOOMANYINPUTSTEST   [(COPYDEF "MYLIST "LIST "TOOMANY)]

   RUNISAPRIMITIVETEST   [(COPYDEF "SUM     "PRODUCT)]
   RUNIDONTKNOWHOWTOTEST [(COPYDEF "XXXCOPY "DOESNOTEXIT)]
   RUNBADINPUTTEST       [(COPYDEF [1]      "SUM)]
   RUNBADINPUTTEST       [(COPYDEF {1}      "SUM)]
   RUNBADINPUTTEST       [(COPYDEF 1        "SUM)]
   RUNBADINPUTTEST       [(COPYDEF "NEWCOPY  [1])]
   RUNBADINPUTTEST       [(COPYDEF "NEWCOPY  {1})]
   RUNBADINPUTTEST       [(COPYDEF "NEWCOPY   1 )]
   RUNIDONTKNOWHOWTOTEST [(NEWCOPY)]
   RUNISAPRIMITIVETEST   [(COPYDEF "SUMCOPY "SUM)]

END

